@namespace BibleComponents
@using Bible_Blazer_PWA.Components
@using Bible_Blazer_PWA.DataBase;
@using Bible_Blazer_PWA.Parameters;
@using Bible_Blazer_PWA.Services.Menu;
@using Bible_Blazer_PWA.ViewModels;
@using MudBlazor.Utilities;
@using Bible_Blazer_PWA.Components.Interactor
@inject MenuService menu;

@if (Visible)
{
    <MudDivider />
    <CenteredFixedContainer ref="child" Elevation="0" Bottom="IsBottom">
        @InteractionRender
    </CenteredFixedContainer>
}

@code {
    [Microsoft.AspNetCore.Components.Parameter]
    public bool Visible { get; set; }
    public bool IsBottom { get; set; }
    private RenderFragment? InteractionRender { get; set; }
    private CenteredFixedContainer child;

    public void SetInteractionModel(IInteractionModel model)
    {
        if (model == null)
        {
            InteractionRender = null;
            return;
        }

        InteractionRender = builder =>
        {
            builder.OpenComponent(0, typeof(MudDivider));
            builder.CloseComponent();
            builder.OpenComponent(1, model.ComponentType);
            builder.AddAttribute(2, "InteractionModel", model);
            builder.CloseComponent();
        };

        IsBottom = model.IsBottom;
    }

    protected override void OnInitialized()
    {
        menu.LessonCenteredContainer = this;
    }

    public void Refresh()
    {
        StateHasChanged();
    }
}
