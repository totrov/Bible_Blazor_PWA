@page "/lessons"
@using Bible_Blazer_PWA.DataSources
@using static Bible_Blazer_PWA.DataSources.LessonDS
@using Bible_Blazer_PWA.DomainObjects
@using Bible_Blazer_PWA.Services.Menu
@inject MenuService menu
@inject Bible_Blazer_PWA.DataBase.DatabaseJSFacade db;

@if (_blocks != null)
{
    <MudExpansionPanels>
        @foreach (LessonBlock block in _blocks)
        {
            <MudExpansionPanel>
                <TitleContent>
                    <MudText Typo="Typo.h5">@block.Name</MudText>
                </TitleContent>
                <ChildContent>
                    <MudList Clickable="true">
                        @foreach (LessonInfo lesson in block.Lessons)
                        {
                            <MudListItem>
                                @*<span class="iconify" data-icon="bx:bx-bible" style="color: #0366d6;"></span><i class="fas fa-bible"></i>*@
                                <NavLink class="nav-link" href="@($"lessonNew/{lesson.Id}/{Unit.GetUnitNumberByShortName(lesson.UnitId)}")" Match="NavLinkMatch.All">@lesson.Name</NavLink>
                            </MudListItem>
                        }
                    </MudList>
                </ChildContent>
            </MudExpansionPanel>
        }
    </MudExpansionPanels>


@*    <h3>Ниже страницы уроков, сделанные без использования БД (будет удалено позже)</h3>

    <ul>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="test">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Виды дел
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="test2">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Виды дел +
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="lesson1">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Урок 1.
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="lesson4">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Урок 4.
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="lesson5">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Урок 5.
            </NavLink>
        </li>
        <li class="nav-item px-3">
            <NavLink class="nav-link" href="lesson6">
                <span class="oi oi-list-rich" aria-hidden="true"></span> Урок 6.
            </NavLink>
        </li>
    </ul>*@
}

@code {
    private LessonDS _lessonDS { get; set; }
    private LinkedList<LessonBlock> _blocks;

    protected override async Task OnInitializedAsync()
    {
        _lessonDS = new LessonDS(db);
        _blocks = await _lessonDS.GetBlocks();
        menu.Title = "Планы уроков";
        menu.ClearMenuButtons();
        menu.Update(this);
    }
}
